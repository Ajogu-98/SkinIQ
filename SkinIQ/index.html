<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SkinIQ â€” Ingredient Analyzer</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;800;900&family=Jost:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
:root {
  /* â”€â”€ Palette from inspiration â”€â”€ */
  --bg:          #C9A08A;      /* outer warm rose-terracotta */
  --bg2:         #D4AE9A;
  --card:        #F0D8C8;      /* inner warm sandy peach card */
  --card2:       #EAD0BE;
  --plum:        #8B2257;      /* deep plum/burgundy CTA */
  --plum-dark:   #6B1840;
  --plum-lt:     #F4D6E5;
  --gold:        #7A5C3A;      /* dark warm gold from jar lid */
  --ink:         #1C0E18;      /* near-black dark brown */
  --body:        #4A2E3A;
  --muted:       #8A6070;
  --light:       #B89AAA;

  /* Status */
  --safe-bg:    #E8F5EE; --safe-fg:    #1B5E35; --safe-border: #A8D5B5;
  --caution-bg: #FDF3E3; --caution-fg: #7A4A00; --caution-border: #F0C87A;
  --flag-bg:    #F9E8EE; --flag-fg:    #8B1A3A; --flag-border:   #E8A0B8;

  --r-sm: 12px; --r-md: 18px; --r-lg: 26px; --r-xl: 36px;
  --shadow-sm: 0 2px 12px rgba(28,14,24,0.10);
  --shadow-md: 0 8px 30px rgba(28,14,24,0.14);
  --shadow-lg: 0 20px 60px rgba(28,14,24,0.18);
  --t: 0.22s ease;
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; }

body {
  font-family: 'Jost', sans-serif;
  background: var(--bg);
  color: var(--ink);
  min-height: 100vh;
  -webkit-font-smoothing: antialiased;
  overflow-x: hidden;
}

/* â”€â”€ Subtle grain texture feel via radial gradients â”€â”€ */
body::before {
  content: '';
  position: fixed; inset: 0; z-index: 0; pointer-events: none;
  background:
    radial-gradient(ellipse 70% 50% at 0% 0%, rgba(255,220,200,0.25) 0%, transparent 60%),
    radial-gradient(ellipse 60% 60% at 100% 100%, rgba(100,30,60,0.12) 0%, transparent 60%);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HEADER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
header {
  position: relative; z-index: 10;
  padding: 40px 64px 36px;
  display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 20px;
  border-bottom: 1.5px solid rgba(28,14,24,0.12);
  background: rgba(201,160,138,0.60);
  backdrop-filter: blur(14px);
}

.logo-eyebrow {
  font-family: 'Jost', sans-serif;
  font-size: 10px; font-weight: 700; letter-spacing: 0.28em; text-transform: uppercase;
  color: var(--plum); margin-bottom: 8px;
}
.logo-title {
  font-family: 'Playfair Display', serif;
  font-size: 52px; font-weight: 900; line-height: 1;
  color: var(--ink); letter-spacing: -0.02em;
}
.logo-title span { color: var(--plum); }
.logo-sub {
  font-size: 14px; font-weight: 400; color: var(--body);
  margin-top: 10px; max-width: 340px; line-height: 1.6;
}

.header-badge {
  background: var(--plum);
  color: #F0D8C8;
  border-radius: 40px; padding: 12px 26px;
  font-family: 'Jost', sans-serif;
  font-size: 13px; font-weight: 700; letter-spacing: 0.06em;
  display: flex; align-items: center; gap: 9px;
  box-shadow: 0 6px 20px rgba(139,34,87,0.35);
}
.badge-dot {
  width: 8px; height: 8px; border-radius: 50%;
  background: #F0D8C8; animation: blink 2s ease-in-out infinite;
}
@keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.3} }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAIN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
main {
  position: relative; z-index: 5;
  max-width: 1080px; margin: 0 auto;
  padding: 52px 64px 100px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INPUT CARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.input-card {
  background: var(--card);
  border-radius: var(--r-xl);
  padding: 40px;
  box-shadow: var(--shadow-lg);
  margin-bottom: 32px;
  border: 1.5px solid rgba(28,14,24,0.08);
}

/* â”€â”€ TABS â”€â”€ */
.tabs {
  display: flex; gap: 4px;
  background: var(--card2);
  border-radius: var(--r-md);
  padding: 5px;
  margin-bottom: 32px;
  width: fit-content;
  border: 1px solid rgba(28,14,24,0.10);
}
.tab-btn {
  padding: 11px 26px; border-radius: 13px;
  font-family: 'Jost', sans-serif;
  font-size: 13.5px; font-weight: 600;
  border: none; background: none; cursor: pointer;
  color: var(--muted);
  display: flex; align-items: center; gap: 8px;
  transition: all var(--t);
}
.tab-btn.active {
  background: var(--plum); color: #F0D8C8;
  box-shadow: 0 3px 14px rgba(139,34,87,0.30);
}
.tab-btn:hover:not(.active) { color: var(--body); }

.tab-panel { display: none; }
.tab-panel.active { display: block; }

.input-label {
  font-size: 10.5px; font-weight: 700; letter-spacing: 0.22em; text-transform: uppercase;
  color: var(--plum); margin-bottom: 8px; display: block;
}
.input-hint {
  font-size: 14px; font-weight: 400; color: var(--body);
  margin-bottom: 18px; line-height: 1.65;
}

textarea#textInput {
  width: 100%; min-height: 130px; resize: vertical;
  border: 1.5px solid rgba(28,14,24,0.14);
  border-radius: var(--r-md);
  padding: 16px 18px;
  font-family: 'Jost', sans-serif;
  font-size: 14px; font-weight: 400;
  color: var(--ink); background: var(--card2);
  line-height: 1.7;
  transition: border-color var(--t), box-shadow var(--t);
}
textarea#textInput:focus {
  outline: none; border-color: var(--plum);
  box-shadow: 0 0 0 3px rgba(139,34,87,0.12);
}
textarea#textInput::placeholder { color: var(--light); }

/* â”€â”€ DROP ZONE â”€â”€ */
.drop-zone {
  border: 2px dashed rgba(139,34,87,0.35);
  border-radius: var(--r-lg); padding: 50px 24px;
  text-align: center; cursor: pointer;
  background: var(--card2); position: relative;
  transition: all var(--t);
}
.drop-zone:hover, .drop-zone.dragover {
  border-color: var(--plum); background: var(--plum-lt);
}
.drop-zone input[type=file] {
  position: absolute; inset: 0; opacity: 0; cursor: pointer; width: 100%; height: 100%;
}
.drop-icon { font-size: 44px; margin-bottom: 14px; }
.drop-title { font-family: 'Playfair Display', serif; font-size: 20px; font-weight: 700; color: var(--ink); margin-bottom: 6px; }
.drop-subtitle { font-size: 13.5px; font-weight: 400; color: var(--muted); }
.drop-formats { display: flex; gap: 8px; justify-content: center; flex-wrap: wrap; margin-top: 16px; }
.format-tag {
  font-size: 11px; font-weight: 700; letter-spacing: 0.08em;
  padding: 4px 12px; border-radius: 20px;
  background: var(--plum-lt); color: var(--plum);
  border: 1px solid rgba(139,34,87,0.2);
}

.image-preview-wrap { display: none; margin-top: 22px; }
.image-preview-wrap.visible { display: flex; gap: 20px; align-items: flex-start; flex-wrap: wrap; }
.image-preview {
  width: 160px; height: 160px; object-fit: cover;
  border-radius: var(--r-md); border: 2px solid rgba(28,14,24,0.12);
  box-shadow: var(--shadow-sm);
}
.img-info { flex: 1; min-width: 140px; }
.img-filename { font-size: 14px; font-weight: 700; color: var(--ink); margin-bottom: 4px; }
.img-size { font-size: 12px; font-weight: 500; color: var(--muted); }
.btn-remove-img {
  margin-top: 12px; font-size: 12px; font-weight: 600; color: var(--flag-fg);
  background: var(--flag-bg); border: 1px solid var(--flag-border);
  border-radius: 8px; padding: 6px 14px; cursor: pointer;
  font-family: 'Jost', sans-serif; transition: all var(--t);
}
.btn-remove-img:hover { opacity: 0.8; }

/* â”€â”€ CAMERA â”€â”€ */
.camera-frame {
  width: 100%; aspect-ratio: 4/3; max-height: 360px;
  background: #1A0A18; border-radius: var(--r-lg); overflow: hidden;
  position: relative; display: flex; align-items: center; justify-content: center;
  border: 2px solid rgba(28,14,24,0.15);
}
#videoEl { width: 100%; height: 100%; object-fit: cover; display: none; }
#canvasEl { display: none; }
.camera-overlay {
  position: absolute; inset: 0;
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  color: white; text-align: center; gap: 12px;
}
.camera-overlay.hidden { display: none; }
.camera-overlay .cam-icon { font-size: 44px; opacity: 0.4; }
.camera-overlay p { font-size: 13px; font-weight: 500; color: rgba(255,255,255,0.45); max-width: 220px; line-height: 1.5; }

.viewfinder {
  position: absolute; inset: 10%;
  border: 2px solid rgba(240,216,200,0.4);
  border-radius: 8px; pointer-events: none; display: none;
}
.viewfinder.visible { display: block; }
.vf-corner { position: absolute; width: 20px; height: 20px; }
.vf-corner.tl { top:-2px;left:-2px;border-top:3px solid var(--card);border-left:3px solid var(--card);border-radius:4px 0 0 0; }
.vf-corner.tr { top:-2px;right:-2px;border-top:3px solid var(--card);border-right:3px solid var(--card);border-radius:0 4px 0 0; }
.vf-corner.bl { bottom:-2px;left:-2px;border-bottom:3px solid var(--card);border-left:3px solid var(--card);border-radius:0 0 0 4px; }
.vf-corner.br { bottom:-2px;right:-2px;border-bottom:3px solid var(--card);border-right:3px solid var(--card);border-radius:0 0 4px 0; }

.scan-controls { display: flex; gap: 12px; margin-top: 18px; flex-wrap: wrap; align-items: center; }
#capturePreview {
  width: 140px; height: 105px; object-fit: cover;
  border-radius: var(--r-sm); border: 2px solid rgba(28,14,24,0.12);
  box-shadow: var(--shadow-sm); display: none;
}
#capturePreview.visible { display: block; }

/* â”€â”€ BUTTONS â”€â”€ */
.actions-row { display: flex; gap: 10px; margin-top: 22px; align-items: center; flex-wrap: wrap; }

.btn-primary {
  background: var(--plum);
  color: #F0D8C8; border: none; border-radius: 40px;
  padding: 15px 36px;
  font-family: 'Jost', sans-serif;
  font-size: 14px; font-weight: 700; letter-spacing: 0.05em;
  cursor: pointer; display: flex; align-items: center; gap: 9px;
  box-shadow: 0 6px 20px rgba(139,34,87,0.35);
  transition: all var(--t);
}
.btn-primary:hover { background: var(--plum-dark); transform: translateY(-1px); box-shadow: 0 8px 26px rgba(139,34,87,0.45); }
.btn-primary:active { transform: translateY(0); }
.btn-primary:disabled { opacity: 0.45; cursor: not-allowed; transform: none; }

.btn-secondary {
  background: var(--card2); border: 1.5px solid rgba(28,14,24,0.14);
  border-radius: 40px; padding: 14px 26px;
  font-family: 'Jost', sans-serif;
  font-size: 13.5px; font-weight: 600; color: var(--body);
  cursor: pointer; transition: all var(--t);
}
.btn-secondary:hover { border-color: var(--plum); color: var(--plum); }

.btn-ghost {
  background: none; border: none;
  font-family: 'Jost', sans-serif;
  font-size: 13px; font-weight: 600; color: var(--light);
  cursor: pointer; transition: color var(--t); padding: 0 6px;
}
.btn-ghost:hover { color: var(--plum); }

.btn-cam {
  background: var(--card2); border: 1.5px solid rgba(28,14,24,0.14);
  border-radius: var(--r-sm); padding: 11px 20px;
  font-family: 'Jost', sans-serif;
  font-size: 13px; font-weight: 600; color: var(--body);
  cursor: pointer; display: flex; align-items: center; gap: 7px;
  transition: all var(--t);
}
.btn-cam:hover { border-color: var(--plum); color: var(--plum); }

.btn-cam-capture {
  background: var(--plum);
  color: #F0D8C8; border: none; border-radius: 50%;
  width: 54px; height: 54px; cursor: pointer; font-size: 20px;
  display: flex; align-items: center; justify-content: center;
  box-shadow: 0 4px 16px rgba(139,34,87,0.35);
  transition: all var(--t);
}
.btn-cam-capture:hover { transform: scale(1.08); box-shadow: 0 6px 22px rgba(139,34,87,0.45); }
.btn-cam-capture:disabled { opacity: 0.4; cursor: not-allowed; transform: none; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LOADING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#loadingSection { display: none; text-align: center; padding: 80px 20px; }
#loadingSection.visible { display: block; }

.loading-orb {
  width: 72px; height: 72px; margin: 0 auto 30px;
  border-radius: 50%;
  border: 3px solid var(--plum-lt);
  border-top-color: var(--plum);
  animation: spin 0.9s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }

.loading-title {
  font-family: 'Playfair Display', serif;
  font-size: 30px; font-weight: 800; color: var(--ink); margin-bottom: 8px;
}
.loading-sub { font-size: 14px; font-weight: 400; color: var(--muted); }

.loading-steps { display: flex; gap: 24px; justify-content: center; margin-top: 30px; flex-wrap: wrap; }
.load-step {
  font-size: 12.5px; font-weight: 600; color: var(--light);
  display: flex; align-items: center; gap: 8px;
  transition: color 0.4s;
}
.load-step.active { color: var(--plum); }
.step-dot {
  width: 8px; height: 8px; border-radius: 50%;
  background: rgba(28,14,24,0.12); transition: background 0.4s;
}
.load-step.active .step-dot { background: var(--plum); animation: blink 1.2s infinite; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ERROR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#errorSection { display: none; margin-bottom: 24px; }
#errorSection.visible { display: block; }
.error-box {
  background: var(--flag-bg); border: 1.5px solid var(--flag-border);
  border-radius: var(--r-md); padding: 18px 22px;
  display: flex; align-items: flex-start; gap: 14px;
}
.error-title { font-size: 14px; font-weight: 700; color: var(--flag-fg); margin-bottom: 4px; }
.error-msg { font-size: 13px; font-weight: 400; color: var(--body); line-height: 1.6; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESULTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#resultsSection { display: none; }
#resultsSection.visible { display: block; }

/* â”€â”€ Product banner â”€â”€ */
.product-banner {
  background: var(--card);
  border: 1.5px solid rgba(28,14,24,0.10);
  border-radius: var(--r-xl); padding: 26px 32px;
  margin-bottom: 26px;
  display: flex; align-items: center; gap: 18px; flex-wrap: wrap;
  box-shadow: var(--shadow-md);
}
.product-icon { font-size: 34px; }
.product-name {
  font-family: 'Playfair Display', serif;
  font-size: 24px; font-weight: 800; color: var(--ink);
}
.product-name-sub { font-size: 12px; font-weight: 600; color: var(--muted); margin-top: 3px; }

/* â”€â”€ Stats â”€â”€ */
.stats-row {
  display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
  gap: 16px; margin-bottom: 26px;
}
.stat-card {
  background: var(--card);
  border-radius: var(--r-md); padding: 24px 16px; text-align: center;
  box-shadow: var(--shadow-sm); transition: transform var(--t);
  border: 1.5px solid rgba(28,14,24,0.08);
}
.stat-card:hover { transform: translateY(-3px); }
.stat-num {
  font-family: 'Playfair Display', serif;
  font-size: 48px; font-weight: 900; line-height: 1; margin-bottom: 6px;
  color: var(--plum);
}
.stat-label { font-size: 11px; font-weight: 700; letter-spacing: 0.14em; text-transform: uppercase; color: var(--muted); }
.stat-safe .stat-num { color: var(--safe-fg); }
.stat-caution .stat-num { color: var(--caution-fg); }
.stat-flag .stat-num { color: var(--flag-fg); }

/* â”€â”€ Summary notes â”€â”€ */
.summary-notes {
  background: var(--card); border: 1.5px solid rgba(28,14,24,0.08);
  border-radius: var(--r-md); padding: 22px 28px; margin-bottom: 22px;
  display: grid; grid-template-columns: 1fr 1fr; gap: 20px;
  box-shadow: var(--shadow-sm);
}
@media(max-width:600px){ .summary-notes { grid-template-columns: 1fr; } }
.note-label { font-size: 10px; font-weight: 700; letter-spacing: 0.2em; text-transform: uppercase; color: var(--plum); margin-bottom: 7px; }
.note-text { font-size: 13.5px; font-weight: 400; color: var(--body); line-height: 1.65; }

/* â”€â”€ Concerns banner â”€â”€ */
.concerns-banner {
  border-radius: var(--r-md); padding: 16px 22px; margin-bottom: 22px;
  display: flex; align-items: flex-start; gap: 14px; border: 1.5px solid;
}
.safe-banner { background: var(--safe-bg); border-color: var(--safe-border); }
.caution-banner { background: var(--caution-bg); border-color: var(--caution-border); }
.flag-banner { background: var(--flag-bg); border-color: var(--flag-border); }
.concerns-banner-icon { font-size: 20px; flex-shrink: 0; margin-top: 2px; }
.concerns-banner-title { font-size: 14px; font-weight: 700; margin-bottom: 6px; }
.safe-banner .concerns-banner-title { color: var(--safe-fg); }
.caution-banner .concerns-banner-title { color: var(--caution-fg); }
.flag-banner .concerns-banner-title { color: var(--flag-fg); }
.concerns-list-inline { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 4px; }
.concern-chip {
  font-size: 12px; font-weight: 600; padding: 4px 12px; border-radius: 20px;
}
.flag-banner .concern-chip { background: rgba(139,26,58,0.10); color: var(--flag-fg); }
.caution-banner .concern-chip { background: rgba(122,74,0,0.10); color: var(--caution-fg); }

/* â”€â”€ Filter pills â”€â”€ */
.filter-bar { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; margin-bottom: 22px; }
.filter-label-txt { font-size: 11px; font-weight: 700; letter-spacing: 0.14em; text-transform: uppercase; color: var(--light); margin-right: 4px; }
.filter-pill {
  border: 1.5px solid rgba(28,14,24,0.12); border-radius: 40px; padding: 9px 20px;
  font-family: 'Jost', sans-serif; font-size: 13px; font-weight: 600;
  cursor: pointer; background: var(--card); color: var(--muted);
  display: flex; align-items: center; gap: 7px; transition: all 0.18s;
}
.filter-pill .pill-count {
  background: var(--card2); border-radius: 20px;
  padding: 1px 8px; font-size: 11px; font-weight: 700; color: var(--muted);
}
.filter-pill:hover { border-color: var(--plum); color: var(--plum); }
.filter-pill.active { background: var(--plum); color: #F0D8C8; border-color: transparent; box-shadow: 0 4px 14px rgba(139,34,87,0.28); }
.filter-pill.active .pill-count { background: rgba(240,216,200,0.25); color: #F0D8C8; }
.filter-pill.f-safe.active { background: var(--safe-fg); }
.filter-pill.f-caution.active { background: var(--caution-fg); }
.filter-pill.f-flag.active { background: var(--flag-fg); }

/* â”€â”€ Ingredient Cards â”€â”€ */
#ingredientsGrid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 18px;
}

.ing-card {
  background: var(--card);
  border: 1.5px solid rgba(28,14,24,0.08);
  border-radius: var(--r-lg); overflow: hidden;
  box-shadow: var(--shadow-sm);
  transition: transform var(--t), box-shadow var(--t);
  animation: cardIn 0.3s ease both;
}
.ing-card:hover { transform: translateY(-5px); box-shadow: var(--shadow-lg); }

@keyframes cardIn {
  from { opacity: 0; transform: translateY(14px); }
  to   { opacity: 1; transform: translateY(0); }
}

.card-strip { height: 5px; }
.strip-safe    { background: linear-gradient(90deg, #34C97A, #A8D5B5); }
.strip-caution { background: linear-gradient(90deg, #E8A030, #F0C87A); }
.strip-flag    { background: linear-gradient(90deg, var(--plum), #E8A0B8); }

.card-head { padding: 18px 20px 14px; display: flex; align-items: flex-start; gap: 12px; }

.safety-bubble {
  flex-shrink: 0; width: 36px; height: 36px; border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 14px; font-weight: 700; margin-top: 1px;
}
.bubble-safe    { background: var(--safe-bg);    color: var(--safe-fg); }
.bubble-caution { background: var(--caution-bg); color: var(--caution-fg); }
.bubble-flag    { background: var(--flag-bg);    color: var(--flag-fg); }

.card-head-text { flex: 1; min-width: 0; }
.card-name {
  font-family: 'Playfair Display', serif;
  font-size: 15px; font-weight: 700; color: var(--ink); line-height: 1.3; margin-bottom: 3px;
}
.card-inci { font-size: 12px; font-weight: 400; color: var(--muted); font-style: italic; line-height: 1.3; }

.card-badge {
  flex-shrink: 0; font-size: 10.5px; font-weight: 700;
  letter-spacing: 0.06em; text-transform: uppercase;
  padding: 4px 12px; border-radius: 20px; margin-top: 2px; white-space: nowrap;
}
.badge-safe    { background: var(--safe-bg);    color: var(--safe-fg);    border: 1px solid var(--safe-border); }
.badge-caution { background: var(--caution-bg); color: var(--caution-fg); border: 1px solid var(--caution-border); }
.badge-flag    { background: var(--flag-bg);    color: var(--flag-fg);    border: 1px solid var(--flag-border); }

.card-body { padding: 0 20px 16px; }
.card-desc { font-size: 13px; font-weight: 400; color: var(--body); line-height: 1.7; margin-bottom: 14px; }

.card-tags { display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 14px; }
.cat-tag {
  font-size: 11px; font-weight: 600; padding: 3px 11px; border-radius: 8px;
  background: var(--plum-lt); color: var(--plum);
  border: 1px solid rgba(139,34,87,0.15);
}

.card-duo { display: flex; gap: 18px; flex-wrap: wrap; }
.card-list-block { flex: 1; min-width: 100px; }
.card-list-title { font-size: 10px; font-weight: 700; letter-spacing: 0.16em; text-transform: uppercase; color: var(--light); margin-bottom: 8px; }
.card-list-block ul { list-style: none; }
.card-list-block ul li { font-size: 12.5px; font-weight: 400; color: var(--body); padding: 2px 0 2px 16px; position: relative; line-height: 1.55; }
.card-list-block ul li::before { content: 'â€¢'; position: absolute; left: 0; font-size: 14px; line-height: 1.3; }
.benefits-block ul li::before { color: var(--safe-fg); }
.concerns-block ul li::before { color: var(--flag-fg); }
.card-list-block ul li.empty { color: var(--light); font-style: italic; }

.card-foot {
  padding: 12px 20px 16px; border-top: 1.5px solid var(--card2);
  display: flex; gap: 18px; flex-wrap: wrap; align-items: center;
}
.foot-item { font-size: 12px; font-weight: 500; color: var(--muted); display: flex; align-items: center; gap: 6px; }
.foot-item strong { font-weight: 700; color: var(--body); }

.comed-meter { display: flex; gap: 3px; align-items: center; }
.c-pip {
  width: 9px; height: 9px; border-radius: 3px;
  background: var(--card2); border: 1px solid rgba(28,14,24,0.10);
}
.c-pip.lit { background: var(--plum); border-color: var(--plum-dark); }

.banned-wrap {
  padding: 10px 20px 14px; border-top: 1.5px solid var(--card2);
  display: flex; align-items: center; gap: 8px; flex-wrap: wrap;
}
.banned-label { font-size: 11px; font-weight: 700; color: var(--muted); }
.banned-chip {
  font-size: 11px; font-weight: 600; padding: 3px 10px; border-radius: 6px;
  background: var(--flag-bg); color: var(--flag-fg); border: 1px solid var(--flag-border);
}

.empty-filter { grid-column: 1/-1; text-align: center; padding: 56px; color: var(--light); }
.empty-filter p { font-size: 14px; font-weight: 500; margin-top: 12px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FOOTER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
footer {
  position: relative; z-index: 5;
  background: rgba(201,160,138,0.60);
  backdrop-filter: blur(14px);
  border-top: 1.5px solid rgba(28,14,24,0.10);
  padding: 28px 64px;
  display: flex; gap: 16px; align-items: center; flex-wrap: wrap; justify-content: space-between;
}
.footer-note { font-size: 12.5px; font-weight: 400; color: var(--body); line-height: 1.65; max-width: 540px; }
.footer-note strong { font-weight: 700; color: var(--ink); }
.footer-badge {
  font-size: 12px; font-weight: 700; color: #F0D8C8;
  display: flex; align-items: center; gap: 7px;
  background: var(--plum); padding: 8px 18px; border-radius: 20px;
  box-shadow: 0 4px 14px rgba(139,34,87,0.28);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESPONSIVE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media(max-width:768px){
  header { padding: 26px 20px; }
  .logo-title { font-size: 38px; }
  main { padding: 28px 16px 60px; }
  .input-card { padding: 22px; }
  .tabs { width: 100%; }
  .tab-btn { flex: 1; justify-content: center; padding: 10px 6px; font-size: 12px; }
  #ingredientsGrid { grid-template-columns: 1fr; }
  .stats-row { grid-template-columns: repeat(2,1fr); }
  footer { padding: 22px 20px; }
}
</style>
</head>
<body>

<!-- HEADER -->
<header>
  <div class="logo-wrap">
    <div class="logo-eyebrow">âœ¦ Ingredient Intelligence</div>
    <div class="logo-title">Skin<span>IQ</span></div>
    <div class="logo-sub">Decode what's really inside your skincare â€” powered by Claude AI.</div>
  </div>
  <div class="header-badge">
    <span class="badge-dot"></span>
    AI-Powered Analysis
  </div>
</header>

<!-- MAIN -->
<main>

  <!-- INPUT CARD -->
  <div class="input-card" id="inputCard">
    <div class="tabs">
      <button class="tab-btn active" onclick="switchTab('text',this)">âœï¸ Type</button>
      <button class="tab-btn" onclick="switchTab('upload',this)">ğŸ“· Upload Photo</button>
      <button class="tab-btn" onclick="switchTab('scan',this)">ğŸ“¡ Live Scan</button>
    </div>

    <!-- TEXT -->
    <div class="tab-panel active" id="panel-text">
      <label class="input-label" for="textInput">Product Name or Ingredient List</label>
      <p class="input-hint">Type a product name like <em>"CeraVe Moisturizing Cream"</em> â€” or paste the full ingredient list straight from the label.</p>
      <textarea id="textInput" placeholder="e.g.  CeraVe Moisturizing Cream&#10;â€” or â€”&#10;Water, Glycerin, Niacinamide, Retinol, Fragrance..."></textarea>
      <div class="actions-row">
        <button class="btn-primary" onclick="runAnalysis('text')">âœ¦ Analyze Ingredients</button>
        <button class="btn-secondary" onclick="loadSample()">Try a Sample</button>
        <button class="btn-ghost" onclick="clearAll()">Clear</button>
      </div>
    </div>

    <!-- UPLOAD -->
    <div class="tab-panel" id="panel-upload">
      <label class="input-label">Upload Label Photo</label>
      <p class="input-hint">Take a photo of the ingredients list on the back of your product and upload it here.</p>
      <div class="drop-zone" id="dropZone">
        <input type="file" id="fileInput" accept="image/*" onchange="handleFileSelect(event)">
        <div class="drop-icon">ğŸŒ¸</div>
        <div class="drop-title">Drop your photo here</div>
        <div class="drop-subtitle">or click to browse from your device</div>
        <div class="drop-formats">
          <span class="format-tag">JPG</span>
          <span class="format-tag">PNG</span>
          <span class="format-tag">WEBP</span>
          <span class="format-tag">HEIC</span>
        </div>
      </div>
      <div class="image-preview-wrap" id="imgPreviewWrap">
        <img class="image-preview" id="imgPreviewEl" src="" alt="Preview">
        <div class="img-info">
          <div class="img-filename" id="imgFilename"></div>
          <div class="img-size" id="imgFilesize"></div>
          <button class="btn-remove-img" onclick="removeUploadedImg()">âœ• Remove</button>
        </div>
      </div>
      <div class="actions-row">
        <button class="btn-primary" id="btnAnalyzeUpload" onclick="runAnalysis('upload')" disabled>âœ¦ Analyze Label</button>
      </div>
    </div>

    <!-- SCAN -->
    <div class="tab-panel" id="panel-scan">
      <label class="input-label">Live Camera Scan</label>
      <p class="input-hint">Point your camera at the ingredient list on a product label. When it's clear, hit capture.</p>
      <div class="camera-frame" id="cameraFrame">
        <video id="videoEl" playsinline autoplay muted></video>
        <canvas id="canvasEl"></canvas>
        <div class="viewfinder" id="viewfinder">
          <div class="vf-corner tl"></div><div class="vf-corner tr"></div>
          <div class="vf-corner bl"></div><div class="vf-corner br"></div>
        </div>
        <div class="camera-overlay" id="cameraOverlay">
          <div class="cam-icon">ğŸ“·</div>
          <p>Grant camera permission to begin scanning.</p>
        </div>
      </div>
      <div class="scan-controls">
        <button class="btn-cam" id="btnStartCam" onclick="startCamera()">ğŸ“· Start Camera</button>
        <button class="btn-cam-capture" id="btnCapture" onclick="captureFrame()" disabled title="Capture">â¬¤</button>
        <button class="btn-cam" id="btnStopCam" onclick="stopCamera()" style="display:none">â¹ Stop</button>
        <img id="capturePreview" alt="Captured frame">
      </div>
      <div class="actions-row">
        <button class="btn-primary" id="btnAnalyzeScan" onclick="runAnalysis('scan')" disabled>âœ¦ Analyze Captured Image</button>
        <button class="btn-ghost" onclick="clearCapture()">Clear</button>
      </div>
    </div>
  </div>

  <!-- ERROR -->
  <div id="errorSection">
    <div class="error-box">
      <div>
        <div class="error-title">âš ï¸ Analysis Failed</div>
        <div class="error-msg" id="errorMsg">Something went wrong. Please try again.</div>
      </div>
    </div>
  </div>

  <!-- LOADING -->
  <div id="loadingSection">
    <div class="loading-orb"></div>
    <div class="loading-title">Analyzing Ingredientsâ€¦</div>
    <div class="loading-sub">Claude AI is identifying and evaluating every ingredient</div>
    <div class="loading-steps">
      <div class="load-step active" id="step1"><span class="step-dot"></span> Extracting ingredients</div>
      <div class="load-step" id="step2"><span class="step-dot"></span> Looking up safety data</div>
      <div class="load-step" id="step3"><span class="step-dot"></span> Generating report</div>
    </div>
  </div>

  <!-- RESULTS -->
  <div id="resultsSection">
    <div class="product-banner" id="productBanner" style="display:none;">
      <span class="product-icon">ğŸ§´</span>
      <div>
        <div class="product-name" id="productNameEl"></div>
        <div class="product-name-sub">AI-identified product</div>
      </div>
      <button class="btn-secondary" style="margin-left:auto" onclick="resetToInput()">+ New Analysis</button>
    </div>
    <div style="display:flex;justify-content:flex-end;margin-bottom:22px;" id="newAnalysisRow">
      <button class="btn-secondary" onclick="resetToInput()">+ New Analysis</button>
    </div>

    <div class="stats-row">
      <div class="stat-card stat-total"><div class="stat-num" id="statTotal">0</div><div class="stat-label">Total Found</div></div>
      <div class="stat-card stat-safe"><div class="stat-num" id="statSafe">0</div><div class="stat-label">Safe</div></div>
      <div class="stat-card stat-caution"><div class="stat-num" id="statCaution">0</div><div class="stat-label">Caution</div></div>
      <div class="stat-card stat-flag"><div class="stat-num" id="statFlag">0</div><div class="stat-label">Flagged</div></div>
    </div>

    <div class="summary-notes" id="summaryNotes"></div>
    <div class="concerns-banner" id="concernsBanner" style="display:none;"></div>

    <div class="filter-bar">
      <span class="filter-label-txt">Show:</span>
      <button class="filter-pill active" data-filter="all" onclick="setFilter('all',this)">All <span class="pill-count" id="fc-all">0</span></button>
      <button class="filter-pill f-safe" data-filter="safe" onclick="setFilter('safe',this)">Safe <span class="pill-count" id="fc-safe">0</span></button>
      <button class="filter-pill f-caution" data-filter="caution" onclick="setFilter('caution',this)">Caution <span class="pill-count" id="fc-caution">0</span></button>
      <button class="filter-pill f-flag" data-filter="flag" onclick="setFilter('flag',this)">Flagged <span class="pill-count" id="fc-flag">0</span></button>
    </div>

    <div id="ingredientsGrid"></div>
  </div>

</main>

<!-- FOOTER -->
<footer>
  <p class="footer-note">
    <strong>Educational use only.</strong> SkinIQ provides general ingredient information based on available research. Always consult a dermatologist for personalized skincare advice.
  </p>
  <div class="footer-badge">âœ¦ Powered by Claude AI</div>
</footer>

<script>
let uploadedFile=null,capturedDataUrl=null,capturedMimeType=null;
let currentStream=null,allIngredients=[],activeFilter='all',loadingStepTimer=null;

function switchTab(name,btn){
  document.querySelectorAll('.tab-panel').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById('panel-'+name).classList.add('active');
  btn.classList.add('active'); hideError();
}
function loadSample(){
  document.getElementById('textInput').value=`Water, Glycerin, Niacinamide, Sodium Hyaluronate, Dimethicone, Cetyl Alcohol, Glycolic Acid, Phenoxyethanol, Retinol, Tocopherol, Fragrance, Zinc Oxide, Salicylic Acid, Centella Asiatica Extract, Caffeine, Linalool, DMDM Hydantoin, Cyclopentasiloxane, Oxybenzone`;
}
function clearAll(){document.getElementById('textInput').value='';hideError();}

function handleFileSelect(e){const f=e.target.files[0];if(f)setUploadedFile(f);}
const dropZone=document.getElementById('dropZone');
dropZone.addEventListener('dragover',e=>{e.preventDefault();dropZone.classList.add('dragover');});
dropZone.addEventListener('dragleave',()=>dropZone.classList.remove('dragover'));
dropZone.addEventListener('drop',e=>{
  e.preventDefault();dropZone.classList.remove('dragover');
  const f=e.dataTransfer.files[0];
  if(f&&f.type.startsWith('image/'))setUploadedFile(f);
});
function setUploadedFile(file){
  uploadedFile=file;
  const reader=new FileReader();
  reader.onload=ev=>{
    document.getElementById('imgPreviewEl').src=ev.target.result;
    document.getElementById('imgPreviewWrap').classList.add('visible');
    document.getElementById('imgFilename').textContent=file.name;
    document.getElementById('imgFilesize').textContent=formatBytes(file.size);
    document.getElementById('btnAnalyzeUpload').disabled=false;
  };
  reader.readAsDataURL(file);
}
function removeUploadedImg(){
  uploadedFile=null;
  document.getElementById('imgPreviewWrap').classList.remove('visible');
  document.getElementById('imgPreviewEl').src='';
  document.getElementById('fileInput').value='';
  document.getElementById('btnAnalyzeUpload').disabled=true;
}
function formatBytes(b){if(b<1024)return b+' B';if(b<1048576)return(b/1024).toFixed(1)+' KB';return(b/1048576).toFixed(1)+' MB';}

async function startCamera(){
  try{
    const stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:{ideal:'environment'},width:{ideal:1920},height:{ideal:1080}}});
    currentStream=stream;
    const video=document.getElementById('videoEl');
    video.srcObject=stream;video.style.display='block';
    document.getElementById('cameraOverlay').classList.add('hidden');
    document.getElementById('viewfinder').classList.add('visible');
    document.getElementById('btnCapture').disabled=false;
    document.getElementById('btnStartCam').style.display='none';
    document.getElementById('btnStopCam').style.display='flex';
  }catch(err){showError('Camera access denied. '+err.message+'. Try the Upload tab instead.');}
}
function stopCamera(){
  if(currentStream){currentStream.getTracks().forEach(t=>t.stop());currentStream=null;}
  const video=document.getElementById('videoEl');
  video.style.display='none';video.srcObject=null;
  document.getElementById('cameraOverlay').classList.remove('hidden');
  document.getElementById('viewfinder').classList.remove('visible');
  document.getElementById('btnCapture').disabled=true;
  document.getElementById('btnStartCam').style.display='flex';
  document.getElementById('btnStopCam').style.display='none';
}
function captureFrame(){
  const video=document.getElementById('videoEl');
  const canvas=document.getElementById('canvasEl');
  canvas.width=video.videoWidth;canvas.height=video.videoHeight;
  canvas.getContext('2d').drawImage(video,0,0);
  const dataUrl=canvas.toDataURL('image/jpeg',0.9);
  capturedDataUrl=dataUrl;capturedMimeType='image/jpeg';
  const preview=document.getElementById('capturePreview');
  preview.src=dataUrl;preview.classList.add('visible');
  document.getElementById('btnAnalyzeScan').disabled=false;
}
function clearCapture(){
  capturedDataUrl=null;capturedMimeType=null;
  const p=document.getElementById('capturePreview');
  p.src='';p.classList.remove('visible');
  document.getElementById('btnAnalyzeScan').disabled=true;
}

async function runAnalysis(mode){
  hideError();
  let payload={};
  if(mode==='text'){
    const text=document.getElementById('textInput').value.trim();
    if(!text){showError('Please enter a product name or ingredient list.');return;}
    payload={mode:'text',content:text};
  }else if(mode==='upload'){
    if(!uploadedFile){showError('Please select an image file first.');return;}
    const base64=await fileToBase64(uploadedFile);
    payload={mode:'image',content:base64,mimeType:uploadedFile.type||'image/jpeg'};
  }else if(mode==='scan'){
    if(!capturedDataUrl){showError('Please capture an image first.');return;}
    payload={mode:'image',content:capturedDataUrl.split(',')[1],mimeType:capturedMimeType};
  }
  showLoading();startLoadingSteps();
  try{
    const res=await fetch('/.netlify/functions/analyze',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
    const data=await res.json();
    if(!res.ok)throw new Error(data.error||`HTTP ${res.status}`);
    hideLoading();renderResults(data);
  }catch(err){
    hideLoading();
    showError('Analysis failed: '+err.message+'. Make sure the ANTHROPIC_API_KEY is set in your Netlify environment variables.');
  }
}
function fileToBase64(file){
  return new Promise((res,rej)=>{
    const r=new FileReader();
    r.onload=e=>res(e.target.result.split(',')[1]);
    r.onerror=rej;r.readAsDataURL(file);
  });
}

function showLoading(){
  document.getElementById('inputCard').style.display='none';
  document.getElementById('loadingSection').classList.add('visible');
  document.getElementById('resultsSection').classList.remove('visible');
}
function hideLoading(){
  document.getElementById('loadingSection').classList.remove('visible');
  clearInterval(loadingStepTimer);
  ['step1','step2','step3'].forEach(id=>document.getElementById(id).classList.remove('active'));
  document.getElementById('step1').classList.add('active');
}
function startLoadingSteps(){
  ['step1','step2','step3'].forEach(id=>document.getElementById(id).classList.remove('active'));
  document.getElementById('step1').classList.add('active');
  let step=1;
  loadingStepTimer=setInterval(()=>{step++;if(step>3){clearInterval(loadingStepTimer);return;}document.getElementById('step'+step).classList.add('active');},1800);
}

function renderResults(data){
  allIngredients=data.ingredients||[];
  const summary=data.summary||{};
  const banner=document.getElementById('productBanner');
  const newRow=document.getElementById('newAnalysisRow');
  if(data.productName){
    document.getElementById('productNameEl').textContent=data.productName;
    banner.style.display='flex';newRow.style.display='none';
  }else{banner.style.display='none';newRow.style.display='flex';}
  document.getElementById('statTotal').textContent=allIngredients.length;
  document.getElementById('statSafe').textContent=summary.safeCount??allIngredients.filter(i=>i.safety==='safe').length;
  document.getElementById('statCaution').textContent=summary.cautionCount??allIngredients.filter(i=>i.safety==='caution').length;
  document.getElementById('statFlag').textContent=summary.flagCount??allIngredients.filter(i=>i.safety==='flag').length;
  const counts={all:allIngredients.length,safe:allIngredients.filter(i=>i.safety==='safe').length,caution:allIngredients.filter(i=>i.safety==='caution').length,flag:allIngredients.filter(i=>i.safety==='flag').length};
  Object.entries(counts).forEach(([k,v])=>{const el=document.getElementById('fc-'+k);if(el)el.textContent=v;});
  const notesEl=document.getElementById('summaryNotes');
  notesEl.innerHTML='';
  if(summary.skinTypeNotes)notesEl.innerHTML+=`<div><div class="note-label">Skin Suitability</div><div class="note-text">${escHtml(summary.skinTypeNotes)}</div></div>`;
  if(summary.pregnancyNote)notesEl.innerHTML+=`<div><div class="note-label">Pregnancy Safety</div><div class="note-text">${escHtml(summary.pregnancyNote)}</div></div>`;
  notesEl.style.display=notesEl.innerHTML?'grid':'none';
  const bannerEl=document.getElementById('concernsBanner');
  const safety=summary.overallSafety||(summary.flagCount>0?'flag':summary.cautionCount>0?'caution':'safe');
  const bc=safety==='flag'?'flag-banner':safety==='caution'?'caution-banner':'safe-banner';
  const bi=safety==='flag'?'ğŸš©':safety==='caution'?'âš ï¸':'âœ…';
  const bt=safety==='flag'?'Flagged Ingredients Found':safety==='caution'?'Some Ingredients Need Caution':'Ingredients Look Generally Safe';
  let bh=`<span class="concerns-banner-icon">${bi}</span><div class="concerns-banner-text"><div class="concerns-banner-title">${bt}</div>`;
  if(summary.topConcerns?.length){bh+=`<div class="concerns-list-inline">${summary.topConcerns.map(c=>`<span class="concern-chip">${escHtml(c)}</span>`).join('')}</div>`;}
  bh+='</div>';
  bannerEl.className=`concerns-banner ${bc}`;bannerEl.innerHTML=bh;bannerEl.style.display='flex';
  activeFilter='all';
  document.querySelectorAll('.filter-pill').forEach(b=>b.classList.remove('active'));
  document.querySelector('.filter-pill[data-filter="all"]').classList.add('active');
  renderCards();
  document.getElementById('resultsSection').classList.add('visible');
  document.getElementById('resultsSection').scrollIntoView({behavior:'smooth',block:'start'});
}

function renderCards(){
  const grid=document.getElementById('ingredientsGrid');
  const filtered=activeFilter==='all'?allIngredients:allIngredients.filter(i=>i.safety===activeFilter);
  grid.innerHTML='';
  if(!filtered.length){grid.innerHTML=`<div class="empty-filter"><div style="font-size:40px;opacity:0.3">ğŸŒ¸</div><p>No ${activeFilter} ingredients found.</p></div>`;return;}
  filtered.forEach((ing,idx)=>grid.appendChild(buildCard(ing,idx)));
}

function buildCard(ing,idx){
  const s=ing.safety||'safe';
  const bubbleIcon=s==='safe'?'âœ“':s==='caution'?'!':'âœ•';
  const comed=Math.min(5,Math.max(0,ing.comedogenic??0));
  let comedHtml='<div class="comed-meter">';
  for(let i=0;i<5;i++)comedHtml+=`<div class="c-pip${i<comed?' lit':''}"></div>`;
  comedHtml+='</div>';
  const benefits=(ing.benefits||[]).slice(0,4);
  const concerns=(ing.concerns||[]).slice(0,4);
  const cats=(ing.category||[]).slice(0,4);
  const preg=ing.pregnancySafe;
  const pregText=preg===true?'Pregnancy safe':preg===false?'Avoid in pregnancy':'Consult doctor';
  const pregIcon=preg===true?'âœ…':preg===false?'âŒ':'â”';
  const ewg=ing.ewgScore;
  const banned=ing.bannedRegions||[];
  const card=document.createElement('div');
  card.className='ing-card';
  card.style.animationDelay=(idx*0.04)+'s';
  card.innerHTML=`
    <div class="card-strip strip-${s}"></div>
    <div class="card-head">
      <div class="safety-bubble bubble-${s}">${bubbleIcon}</div>
      <div class="card-head-text">
        <div class="card-name">${escHtml(ing.name||'Unknown')}</div>
        <div class="card-inci">${escHtml(ing.inci||'')}</div>
      </div>
      <div class="card-badge badge-${s}">${s==='safe'?'Safe':s==='caution'?'Caution':'Flagged'}</div>
    </div>
    <div class="card-body">
      <p class="card-desc">${escHtml(ing.description||'')}</p>
      ${cats.length?`<div class="card-tags">${cats.map(c=>`<span class="cat-tag">${escHtml(c)}</span>`).join('')}</div>`:''}
      <div class="card-duo">
        <div class="card-list-block benefits-block">
          <div class="card-list-title">Benefits</div>
          <ul>${benefits.length?benefits.map(b=>`<li>${escHtml(b)}</li>`).join(''):'<li class="empty">â€”</li>'}</ul>
        </div>
        <div class="card-list-block concerns-block">
          <div class="card-list-title">Concerns</div>
          <ul>${concerns.length?concerns.map(c=>`<li>${escHtml(c)}</li>`).join(''):'<li class="empty">None noted</li>'}</ul>
        </div>
      </div>
    </div>
    <div class="card-foot">
      <div class="foot-item">Comedogenic ${comedHtml} <strong>${comed}/5</strong></div>
      <div class="foot-item"><span>${pregIcon}</span> <span>${pregText}</span></div>
      ${ewg!=null?`<div class="foot-item">EWG <strong>${ewg}/10</strong></div>`:''}
    </div>
    ${banned.length?`<div class="banned-wrap"><span class="banned-label">Restricted:</span>${banned.map(r=>`<span class="banned-chip">${escHtml(r)}</span>`).join('')}</div>`:''}
  `;
  return card;
}

function setFilter(filter,btn){
  activeFilter=filter;
  document.querySelectorAll('.filter-pill').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');renderCards();
}
function showError(msg){
  document.getElementById('errorMsg').textContent=msg;
  document.getElementById('errorSection').classList.add('visible');
  document.getElementById('inputCard').style.display='block';
}
function hideError(){document.getElementById('errorSection').classList.remove('visible');}
function resetToInput(){
  document.getElementById('resultsSection').classList.remove('visible');
  document.getElementById('inputCard').style.display='block';
  document.getElementById('inputCard').scrollIntoView({behavior:'smooth'});
  allIngredients=[];
}
function escHtml(str){
  if(!str)return'';
  return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}
</script>
</body>
</html>
